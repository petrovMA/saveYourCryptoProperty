<!DOCTYPE html>
<html>
<head>
  <title>Save Your Tezos property</title>
  <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.3.1/css/bootstrap.min.css">
  <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.7/umd/popper.min.js"></script>
  <script src="https://maxcdn.bootstrapcdn.com/bootstrap/4.3.1/js/bootstrap.min.js"></script>

  <script src="./libs/jquery-3.1.1.slim.min.js"></script>
  <script src="./libs/eztz.min.js"></script>
  <script src="./libs/tezos.js"></script>
</head>
<body class="container">
<div>Contract source code: <a href="contract.liq" target="_blank">file</a>
  <a href="https://github.com/petrovma92/saveYourCryptoProperty/blob/master/static/contract.liq"
     target="_blank">GitHub</a>
</div>
<div id="alerts"></div>
<div>Your account <strong><span id="account"></span></strong> has balance: <strong><span id="balance"></span></strong> ꜩ
</div>
<br>
<br>
<div class="container" id="blockchain">
  <div class="form-group">
    <label for="contract">Contract address:</label>
    <input type="text" class="form-control" id="contract">
  </div>
  <h2>Unlock by:</h2>
  <div class="dropdown">
    <button type="button" class="btn btn-info dropdown-toggle" data-toggle="dropdown" id="dropdown-unlock">
      Mnemonic phrase
    </button>
    <div class="dropdown-menu">
      <a class="dropdown-item" href="#">Mnemonic phrase</a>
      <a class="dropdown-item" href="#">Private key</a>
    </div>
  </div>
  <div id="mnem">
    <div class="form-group">
      <label for="phrase">Mnemonic phrase:</label>
      <input type="text" class="form-control" id="phrase">
    </div>
    <div class="form-group">
      <label for="password">Password:</label>
      <input type="password" class="form-control" id="password">
      <label for="password-id"><span>Show Password</span></label>
      <input type="checkbox" onclick="hide('password')" id="password-id" checked>
    </div>
  </div>

  <div id="keys">
    <div class="form-group">
      <label for="key">Key:</label>
      <input type="password" class="form-control" id="key">
      <label for="key-id"><span>Show Key</span></label>
      <input type="checkbox" onclick="hide('key')" id="key-id" checked>
    </div>
  </div>

  <a href="#" onclick="balanceBtn()" class="btn btn-primary">Your Balance</a>
  <a href="#" onclick="pingContractBtn()" class="btn btn-primary">Ping</a>
  <a href="#" onclick="receivePropertyBtn()" class="btn btn-primary">Receive</a>

  <div class="form-group">
    <label for="new-owner">New owner:</label>
    <input type="text" class="form-control" id="new-owner">
    <a href="#" onclick="changeOwnerBtn()" class="btn btn-primary">Set new owner</a>
  </div>

  <div class="form-group">
    <label for="delay-time">Enter time:</label>
    <input type="number" class="form-control" id="delay-time">
    <label for="time-type">Time measure type (year, month, day, hour, minute):</label>
    <input type="text" class="form-control" id="time-type">
    <a href="#" onclick="updateDelayBtn()" class="btn btn-primary">Change delay</a>
  </div>

  <div class="form-group">
    <label for="dest">Destination address:</label>
    <input type="text" class="form-control" id="dest">
    <label for="amount">Amount ꜩ:</label>
    <input type="number" step="0.000001" class="form-control" id="amount">
    <a href="#" onclick="withdrawBtn()" class="btn btn-primary">Withdraw</a>
  </div>

  <div class="form-group">
    <label for="recipient">Recipient address:</label>
    <input type="text" class="form-control" id="recipient">
    <a href="#" onclick="recipientBtn()" class="btn btn-primary">Set recipient</a>
  </div>
</div>
<script>
  function balanceBtn () {
    balance(
      getKeys(),
      document.getElementById('contract').value
    )
  }

  function pingContractBtn () {
    pingContract(
      getKeys(),
      document.getElementById('contract').value
    )
  }

  function receivePropertyBtn () {
    receiveProperty(
      getKeys(),
      document.getElementById('contract').value
    )
  }

  function changeOwnerBtn () {
    changeOwner(
      getKeys(),
      document.getElementById('contract').value,
      document.getElementById('new-owner').value
    )
  }

  function updateDelayBtn () {
    updateDelay(
      getKeys(),
      document.getElementById('contract').value,
      document.getElementById('delay-time').value,
      document.getElementById('time-type').value
    )
  }

  function withdrawBtn () {
    withdraw(
      getKeys(),
      document.getElementById('contract').value,
      document.getElementById('dest').value,
      document.getElementById('amount').value
    )
  }

  function recipientBtn () {
    setRecipient(
      getKeys(),
      document.getElementById('contract').value,
      document.getElementById('recipient').value
    )
  }

  $('.dropdown-menu').on('click', 'a', function () {
    let text = $(this).html()
    let htmlText = text + ' <span class="caret"></span>'
    if (htmlText.startsWith('Mnemonic phrase')) {
      document.getElementById('keys').style.display = 'none'
      document.getElementById('mnem').style.display = 'block'
    } else {
      document.getElementById('keys').style.display = 'block'
      document.getElementById('mnem').style.display = 'none'
    }
    $(this).closest('.dropdown').find('.dropdown-toggle').html(htmlText)
  })

  $(function () {
    document.getElementById('keys').style.display = 'none'
    document.getElementById('mnem').style.display = 'block'
  })

  function getKeys () {
    if (document.getElementById('keys').style.display === 'block') {
      return getKeysByKey(document.getElementById('key').value)
    } else {
      return getKeysByPhrase(document.getElementById('phrase').value, document.getElementById('password').value)
    }
  }

  function hide (psswdId) {
    let box = document.getElementById(psswdId)
    if (document.getElementById(psswdId + '-id').checked === true) {
      box.type = 'text'
    } else {
      box.type = 'password'
    }
  }

</script>
</body>
</html>
